# üß© M√≥dulo 5: Entradas/Salidas y Conectividad  
## **Tema 5.3: Persistencia con SQLite y PostgreSQL (Introducci√≥n)**

---

### üéØ Objetivo del tema
Comprender c√≥mo almacenar y recuperar informaci√≥n de manera persistente utilizando bases de datos relacionales.
Introducir los fundamentos de SQL y las diferencias entre SQLite (ligera y embebida) y PostgreSQL (servidor robusto y escalable).

---

## üß† 1. Introducci√≥n a las Bases de Datos

Una **base de datos** es un sistema organizado para almacenar, gestionar y recuperar informaci√≥n de forma eficiente.
El **Sistema de Gesti√≥n de Bases de Datos (DBMS)** es el software que permite interactuar con esas bases, garantizando integridad, seguridad y concurrencia de los datos.

### Tipos de bases de datos
- **Relacionales (SQL):** estructuran los datos en tablas (filas y columnas).
  Ej: MySQL, PostgreSQL, SQLite, Oracle.
- **No Relacionales (NoSQL):** almacenan datos en formato clave-valor, documentos, grafos, etc.
  Ej: MongoDB, Redis, Cassandra.

En este tema nos centraremos en las **bases de datos relacionales**, que utilizan el lenguaje **SQL (Structured Query Language)**.

---

## üßæ 2. Lenguaje SQL: Fundamentos

El **SQL** es un lenguaje est√°ndar para definir, manipular y consultar datos en una base de datos relacional.

### Principales tipos de sentencias SQL

| Tipo | Descripci√≥n | Ejemplo |
|------|--------------|----------|
| **DDL (Data Definition Language)** | Define la estructura de la base (tablas, √≠ndices, etc.) | `CREATE TABLE productos (...)` |
| **DML (Data Manipulation Language)** | Inserta, modifica o elimina datos | `INSERT INTO`, `UPDATE`, `DELETE` |
| **DQL (Data Query Language)** | Consulta los datos almacenados | `SELECT * FROM productos` |
| **DCL (Data Control Language)** | Control de permisos y usuarios | `GRANT`, `REVOKE` |

### Ejemplo general de SQL
```sql
CREATE TABLE productos (
    id INTEGER PRIMARY KEY,
    nombre TEXT NOT NULL,
    precio REAL,
    stock INTEGER
);

INSERT INTO productos (nombre, precio, stock)
VALUES ('Tornillos', 0.25, 500);

SELECT nombre, precio FROM productos WHERE stock > 100;
```

---

## üóÇÔ∏è 3. SQLite: Base de datos ligera y embebida

**SQLite** es una base de datos relacional que no requiere instalaci√≥n de servidor.
Guarda toda la informaci√≥n en un solo archivo (`.db` o `.sqlite`), ideal para desarrollo local o aplicaciones peque√±as.

### Ventajas
- No necesita servidor.
- R√°pida y portable (archivo √∫nico).
- Compatible con Python y otras herramientas.
- Sintaxis SQL est√°ndar.

### Ejemplo b√°sico en Python
```python
import sqlite3

# Crear o conectar a una base de datos
conn = sqlite3.connect("inventario.db")

# Crear un cursor
cursor = conn.cursor()

# Crear una tabla
cursor.execute("""
CREATE TABLE IF NOT EXISTS productos (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    nombre TEXT NOT NULL,
    precio REAL,
    stock INTEGER
)
""")

# Insertar un registro
cursor.execute("INSERT INTO productos (nombre, precio, stock) VALUES (?, ?, ?)", ("Tornillos", 0.25, 500))

# Guardar cambios
conn.commit()

# Consultar datos
cursor.execute("SELECT * FROM productos")
for fila in cursor.fetchall():
    print(fila)

# Cerrar conexi√≥n
conn.close()
```

üí° **Observaci√≥n:**
SQLite es excelente para proyectos individuales o educativos, pero no es ideal para sistemas multiusuario o de alta concurrencia.

---

## üêò 4. PostgreSQL: Base de datos robusta y escalable

**PostgreSQL** es un sistema gestor de bases de datos relacional y **orientado a objetos**, reconocido por su estabilidad, rendimiento y cumplimiento de est√°ndares SQL.
Es ideal para aplicaciones empresariales, APIs y sistemas en producci√≥n.

### Caracter√≠sticas principales
- Soporte multiusuario y transacciones ACID.
- Extensible: permite tipos de datos personalizados, funciones y vistas materializadas.
- Ideal para integrarse con frameworks como Django o SQLAlchemy.
- Compatible con operaciones avanzadas (√≠ndices, joins complejos, triggers).

---

### Ejemplo de conexi√≥n desde Python

Para usar PostgreSQL en Python, se utiliza la librer√≠a `psycopg2`:

```bash
pip install psycopg2-binary
```

```python
import psycopg2

# Conexi√≥n al servidor PostgreSQL
conn = psycopg2.connect(
    host="localhost",
    database="mi_base",
    user="mi_usuario",
    password="mi_contrase√±a"
)

cursor = conn.cursor()

# Crear tabla
cursor.execute("""
CREATE TABLE IF NOT EXISTS clientes (
    id SERIAL PRIMARY KEY,
    nombre VARCHAR(100),
    email VARCHAR(100)
)
""")

# Insertar datos
cursor.execute("INSERT INTO clientes (nombre, email) VALUES (%s, %s)", ("Ana L√≥pez", "ana@example.com"))

conn.commit()

# Consultar datos
cursor.execute("SELECT * FROM clientes")
print(cursor.fetchall())

conn.close()
```

üí° **Nota:**
A diferencia de SQLite, PostgreSQL corre como un **servidor**.
Requiere configuraci√≥n de usuario, base y permisos, pero ofrece **mayor seguridad, escalabilidad y concurrencia**.

---

## ‚öñÔ∏è 5. Comparativa general

| Caracter√≠stica | SQLite | PostgreSQL |
|----------------|---------|-------------|
| Tipo | Embebida (archivo local) | Servidor cliente-servidor |
| Configuraci√≥n | Ninguna | Requiere instalaci√≥n y usuario |
| Rendimiento | Excelente en baja concurrencia | Excelente en entornos multiusuario |
| Escalabilidad | Limitada | Muy alta |
| Ideal para | Prototipos, apps m√≥viles, tests | Producci√≥n, APIs, sistemas empresariales |

---

## üß© 6. Conclusiones

- Las bases de datos permiten **persistir** datos de forma estructurada y segura.
- **SQLite** es ideal para aprendizaje y aplicaciones locales.
- **PostgreSQL** es preferible en entornos de producci√≥n o multiusuario.
- Comprender SQL es esencial para cualquier programador: sus conceptos se aplican en casi todos los entornos de datos.

---

## üß± 7. ORM ‚Äì Object Relational Mapping

Un **ORM (Object Relational Mapper)** es una capa intermedia que permite interactuar con una base de datos usando **objetos y clases** en lugar de escribir directamente c√≥digo SQL.
De esta forma, podemos trabajar con datos de manera m√°s **natural y segura** dentro de un lenguaje de programaci√≥n orientado a objetos.

### Ventajas
- Evita escribir SQL manual repetitivo.
- Permite mantener el c√≥digo m√°s limpio y mantenible.
- Mejora la portabilidad entre distintos motores (SQLite, PostgreSQL, MySQL, etc.).
- Permite aplicar validaciones y relaciones entre entidades directamente desde el modelo.

---

### Ejemplo introductorio con SQLAlchemy

Instalaci√≥n:

```bash
pip install sqlalchemy
```

C√≥digo:

```python
from sqlalchemy import create_engine, Column, Integer, String, Float
from sqlalchemy.orm import declarative_base, sessionmaker

# Definir la base (modelo ORM)
Base = declarative_base()

class Producto(Base):
    __tablename__ = "productos"
    id = Column(Integer, primary_key=True)
    nombre = Column(String)
    precio = Column(Float)
    stock = Column(Integer)

# Crear motor de base de datos (SQLite)
engine = create_engine("sqlite:///inventario_orm.db")

# Crear tablas
Base.metadata.create_all(engine)

# Crear sesi√≥n
Session = sessionmaker(bind=engine)
session = Session()

# Insertar nuevos registros
p1 = Producto(nombre="Clavos", precio=0.15, stock=300)
p2 = Producto(nombre="Tuercas", precio=0.45, stock=150)
session.add_all([p1, p2])
session.commit()

# Consultar datos
productos = session.query(Producto).filter(Producto.precio > 0.2).all()
for p in productos:
    print(f"{p.nombre} - ${p.precio}")

session.close()
```

üîç **Qu√© hace este ejemplo:**
- Define una clase `Producto` que representa una tabla.
- Crea la base de datos y la tabla autom√°ticamente.
- Inserta objetos Python que se convierten en registros SQL.
- Consulta los datos usando m√©todos en lugar de sentencias SQL.

üí° **Conclusi√≥n:**
Los ORM son especialmente √∫tiles en proyectos grandes, ya que facilitan la integraci√≥n con frameworks web (como Flask o Django) y ayudan a mantener una capa de datos limpia y desacoplada.

---

## üìö Recursos recomendados

- [Documentaci√≥n oficial de SQLite](https://www.sqlite.org/docs.html)
- [Documentaci√≥n oficial de PostgreSQL](https://www.postgresql.org/docs/)
- [Python `sqlite3` module](https://docs.python.org/3/library/sqlite3.html)
- [Python `psycopg2`](https://www.psycopg.org/docs/)
- [SQLAlchemy ORM Documentation](https://docs.sqlalchemy.org/en/20/orm/)

---

## üßÆ Ejercicio sugerido

Crea un script que:
1. Cree una base SQLite llamada `ventas.db`.
2. Genere una tabla `ventas` con campos: `id`, `producto`, `cantidad`, `precio`.
3. Inserte varios registros.
4. Calcule el total de ventas (`cantidad * precio`).
5. Luego, implementa el mismo modelo usando **SQLAlchemy ORM** y observa las diferencias en la forma de trabajar con los datos.

---
