# üêç M√≥dulo 3: Fundamentos de Python

## **Tema 3.4 ‚Äì Est√°ndares de c√≥digo (PEP 8), formateo y tipado con `typing`**

Este tema introduce las **buenas pr√°cticas de estilo**, el **formateo autom√°tico** y el **tipado est√°tico** en Python. La meta es escribir c√≥digo **legible, consistente y confiable** con herramientas modernas del ecosistema.

---

## üß≠ 1) Est√°ndares de c√≥digo (PEP¬†8): lo esencial

> *Mantendremos esta secci√≥n breve*: listamos solo los puntos de mayor impacto. Para m√°s detalle, ver la documentaci√≥n oficial de **PEP¬†8**.

* **Longitud de l√≠nea**: hasta **79‚Äì88** caracteres (muchos equipos usan 88 por defecto con *black*).
* **Nombres**:

  * M√≥dulos/paquetes: `snake_case` corto: `mi_paquete`, `utils`.
  * Funciones y variables: `snake_case`: `procesar_datos`.
  * Clases y *Exceptions*: `PascalCase`: `UserProfile`, `ConfigError`.
  * Constantes: `UPPER_CASE`: `DEFAULT_TIMEOUT`.
  * ‚ÄúPrivadas‚Äù: prefijo `_`: `_helper()`.
* **Espacios**:

  * Alrededor de operadores: `a + b * c` (no `a+b*c`).
  * Comas seguidas de espacio: `f(a, b, c)`.
  * Evitar espacios extra dentro de par√©ntesis: `func(a, b)`, no `func( a, b )`.
* **Imports**: uno por l√≠nea, orden: est√°ndar ‚Üí terceros ‚Üí locales. Evitar `import *`.
* **Docstrings**: usar triple comillas `"""` y describir *qu√©* hace y *qu√© retorna*.
* **Comentarios**: claros y actualizados; no repetir lo obvio.

üëâ **Referencia oficial**: [PEP¬†8 ‚Äì Style Guide for Python Code](https://peps.python.org/pep-0008/)

### Convenciones √∫tiles (fuera de PEP¬†8)

* **Estructura del repo**: `src/` para c√≥digo, `tests/` para pruebas, `pyproject.toml` para configuraci√≥n.
* **Ramas Git**: `feat/`, `fix/`, `chore/` y *commits* claros.
* **Entornos**: usar `venv`/`uv`/`conda`. Fijar versiones en `requirements.txt` o `pyproject.toml`.
* **Errores**: excepciones espec√≠ficas; evitar `except Exception` gen√©rico.

---

## üé® 2) Formateo autom√°tico: conceptos y herramientas

**Formateo autom√°tico** ‚â† **linting**:

* *Formateador* reescribe el c√≥digo para cumplir un estilo (idempotente).
* *Linter* se√±ala problemas de estilo/errores (a veces puede autocorregir).

### Recomendaci√≥n est√°ndar: **black**

* Opinado, r√°pido e **idempotente**.
* Alinea con 88 chars por defecto, decide comillas, quiebres de l√≠neas, etc.

**Instalaci√≥n y uso**:

```bash
pip install black
black .         # formatea todo el proyecto
black app/      # formatea una carpeta
```

**Complementos √∫tiles**:

* **isort** (ordena imports):

  ```bash
  pip install isort
  isort .
  ```
* **ruff** (linter + reglas de PEP¬†8, errores comunes y m√°s):

  ```bash
  pip install ruff
  ruff check .
  ```

**Configuraci√≥n unificada** (`pyproject.toml`):

```toml
[tool.black]
line-length = 88
target-version = ["py311"]

[tool.isort]
profile = "black"

[tool.ruff]
line-length = 88
select = ["E","F","I","B"]
```

> üí° **Sugerencia**: integrar `black`, `isort` y `ruff` en *pre-commit hooks*.

---

## üî° 3) Tipado con `typing`

El tipado en Python es **opcional** y **est√°tico** (comprobado por herramientas como *mypy* o *pyright*). **No cambia** la ejecuci√≥n por defecto, pero ofrece:

### Beneficios

* **Autocompletado** y **detecci√≥n temprana** de errores.
* **Documentaci√≥n viva** del contrato de funciones y clases.
* **Mantenibilidad**: facilita refactors y colaboraci√≥n.

### Limitaciones

* No valida autom√°ticamente en **tiempo de ejecuci√≥n** (salvo que uses bibliotecas de validaci√≥n).
* Requiere **disciplina** para anotar y mantener tipos.

### Casos de uso t√≠picos

* APIs internas/externas, librer√≠as reutilizables, *data pipelines*, *domain models*, validaci√≥n de *DTOs*, *config*.

---

### 3.1 Sintaxis b√°sica de anotaciones

```python
def area_rect(base: float, altura: float) -> float:
    return base * altura

x: int = 10
nombre: str | None = None   # equivalente a Optional[str]
```

* Python 3.9+: tipos gen√©ricos nativos: `list[int]`, `dict[str, float]`.
* Uni√≥n de tipos con `|` (PEP¬†604): `str | int` en vez de `Union[str, int]`.

### 3.2 Tipos comunes en `typing`

```python
from typing import Optional, Union, Literal, Annotated, Callable, Iterable, Iterator
from typing import TypedDict, Protocol, TypeAlias, NewType, Final, Any

Edad = NewType("Edad", int)         # tipo nominal
UserId: TypeAlias = int              # alias de tipo

def cargar(uid: UserId, activo: bool = True) -> Optional[str]:
    ...

Modo = Literal["r", "w", "a"]
def abrir(path: str, modo: Modo) -> str: ...

# Tipos estructurales (duck typing)
class ConNombre(Protocol):
    @property
    def name(self) -> str: ...

class Persona:
    def __init__(self, name: str):
        self.name = name

def saluda(x: ConNombre) -> str:
    return f"Hola {x.name}"

# Diccionarios con esquema
class UserDTO(TypedDict):
    id: int
    email: str
    is_active: bool
```

### 3.3 Gen√©ricos y variables de tipo

```python
from typing import TypeVar, Generic, Sequence

T = TypeVar("T")

class Caja(Generic[T]):
    def __init__(self, valor: T):
        self.valor = valor
    def obtener(self) -> T:
        return self.valor

def primero(items: Sequence[T]) -> T:
    return items[0]
```

### 3.4 `Annotated`, `Callable` y funciones de orden superior

```python
from typing import Annotated, Callable

Grados = Annotated[float, "¬∞C"]

def transformar(x: float, f: Callable[[float], float]) -> float:
    return f(x)

print(transformar(3.0, lambda v: v * 2))  # 6.0
```

### 3.5 `dataclasses` tipadas

```python
from dataclasses import dataclass

@dataclass
class Producto:
    id: int
    nombre: str
    precio: float
```

---

## üß™ 4) Comprobaci√≥n est√°tica: `mypy` / `pyright`

* **mypy** (CLI cruz-plataforma):

  ```bash
  pip install mypy
  mypy src/
  ```
* **pyright** (muy r√°pido; integrado en VS¬†Code):

  * Extensi√≥n *Pylance/pyright* o `pip install pyright`.

Config m√≠nima (`mypy.ini`):

```ini
[mypy]
python_version = 3.11
strict = False
warn_unused_ignores = True
warn_redundant_casts = True
```

> üí° Empez√° con modo laxo y endurec√© reglas gradualmente.

---

## üß∞ 5) Validaci√≥n de *inputs* en tiempo de ejecuci√≥n

El *typing* est√°ndar no valida valores en tiempo real. Para eso se usan librer√≠as como **pydantic** (v2) o **typed-validators**.

### 5.1 Validaci√≥n con `pydantic` (recomendado)

```python
# pip install pydantic
from pydantic import BaseModel, EmailStr, PositiveInt, ValidationError

class UserIn(BaseModel):
    id: PositiveInt
    email: EmailStr
    is_active: bool = True

try:
    u = UserIn(id=10, email="ana@example.com")
    print(u.model_dump())
except ValidationError as e:
    print(e)
```

### 5.2 Validaci√≥n ligera con `TypedDict` + comprobaciones propias

```python
from typing import TypedDict

class PagoIn(TypedDict):
    monto: float
    moneda: str  # 'ARS' | 'USD'

def validar_pago(p: PagoIn) -> None:
    assert p["monto"] > 0, "monto debe ser positivo"
    assert p["moneda"] in {"ARS", "USD"}, "moneda inv√°lida"
```

### 5.3 Conversi√≥n y *casting*

```python
from typing import Any, cast

def get_nombre(d: dict[str, Any]) -> str:
    valor = d.get("nombre")
    assert isinstance(valor, str), "nombre debe ser str"
    return cast(str, valor)
```

---

## üìå 6) Buenas pr√°cticas con tipos

* Anotar **interfaces p√∫blicas** (funciones y m√©todos) y **modelos de datos**.
* Evitar `Any` salvo en bordes de I/O o *legacy*; preferir `object` o tipos m√°s precisos.
* Usar `Optional`/`| None` solo cuando realmente se admite ausencia de valor.
* Documentar invariantes con `Literal`, `NewType` o `TypedDict` cuando corresponda.
* Combinar *black* + *ruff* + *mypy/pyright* en CI.

---

## üîó Referencias

* **PEP¬†8** (gu√≠a de estilo): [https://peps.python.org/pep-0008/](https://peps.python.org/pep-0008/)
* **Black** (formateador): [https://github.com/psf/black](https://github.com/psf/black)
* **Typing** (docs oficiales): [https://docs.python.org/3/library/typing.html](https://docs.python.org/3/library/typing.html)
* **Mypy**: [https://mypy.readthedocs.io/](https://mypy.readthedocs.io/)
* **Pyright**: [https://github.com/microsoft/pyright](https://github.com/microsoft/pyright)
* **Pydantic**: [https://docs.pydantic.dev/](https://docs.pydantic.dev/)

---

> ‚úÖ Con estas pr√°cticas y herramientas, tu c√≥digo ser√° m√°s **limpio**, **consistente** y **seguro**, y tu equipo podr√° colaborar con mayor confianza y velocidad.
